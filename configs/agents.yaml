name: triageflow-agents
version: "1.0"
description: Combined agent and tool configuration for TriageFlow

# =============================================================================
# MODEL CONFIGURATIONS
# =============================================================================
models:
  local:
    name: "qwen2.5-3b-instruct"
    type: "local"
    endpoint: "https://genai-llm.domino-eval.com/endpoints/bf209962-1bd0-4524-87c8-2d0ac662a022/v1"

  openai:
    name: "gpt-4o-mini"
    type: "api"

  anthropic:
    name: "claude-sonnet-4-20250514"
    type: "api"

# Per-agent model assignment (for multi-model mode)
agent_models:
  classifier: "openai"
  impact_assessor: "openai"
  resource_matcher: "local"
  response_drafter: "anthropic"

# =============================================================================
# UNIFIED TOOL POOL
# All tools available to all agents - agents choose based on context
# =============================================================================
tools:
  # All tools defined once in a single pool
  all_tools:
    - name: lookup_category_definitions
      description: Get official category definitions and classification criteria for incident categorization
      parameters:
        type: object
        properties: {}
        required: []

    - name: lookup_historical_incidents
      description: Search for similar historical incidents to inform impact assessment and learn from past resolutions
      parameters:
        type: object
        properties:
          category:
            type: string
            description: Incident category
          subcategory:
            type: string
            description: Incident subcategory
          limit:
            type: integer
            description: Max results
            default: 5
        required: [category, subcategory]

    - name: calculate_impact_score
      description: Calculate normalized impact score (0-10) based on urgency, affected users, systems, and business factors
      parameters:
        type: object
        properties:
          urgency:
            type: integer
            description: Urgency level 1-5
          affected_users:
            type: integer
            description: Estimated affected users
          affected_systems_count:
            type: integer
            description: Number of affected systems
          has_financial_impact:
            type: boolean
            description: Whether there is financial impact
          has_compliance_implications:
            type: boolean
            description: Whether there are compliance implications
        required: [urgency, affected_users, affected_systems_count, has_financial_impact, has_compliance_implications]

    - name: check_resource_availability
      description: Check available resources matching required skills and current workload
      parameters:
        type: object
        properties:
          required_skills:
            type: array
            items:
              type: string
            description: Required skills
          urgency:
            type: integer
            description: Urgency level 1-5
        required: [required_skills, urgency]

    - name: get_sla_requirements
      description: Get SLA requirements (response time, resolution time) based on urgency and category
      parameters:
        type: object
        properties:
          urgency:
            type: integer
            description: Urgency level 1-5
          category:
            type: string
            description: Incident category
        required: [urgency, category]

    - name: get_communication_templates
      description: Get communication templates for different audiences (technical team, management, affected users)
      parameters:
        type: object
        properties:
          category:
            type: string
            description: Incident category
          urgency:
            type: integer
            description: Urgency level 1-5
        required: [category, urgency]

    - name: get_stakeholder_list
      description: Determine which stakeholders need notification based on incident scope and impact
      parameters:
        type: object
        properties:
          category:
            type: string
            description: Incident category
          impact_score:
            type: number
            description: Impact score 0-10
          blast_radius:
            type: string
            description: Blast radius level (contained, department, organization, external)
        required: [category, impact_score, blast_radius]

    - name: propose_slack_message
      description: Propose an internal Slack message for team communication and coordination
      parameters:
        type: object
        properties:
          channel:
            type: string
            description: "Target Slack channel - must be one of: general, IT, HR, Finance, Engineering"
            enum: [general, IT, HR, Finance, Engineering]
          message:
            type: string
            description: The message content to post
        required: [channel, message]

    - name: draft_external_communication
      description: Draft external communication for customers, press, or regulatory bodies requiring approval workflow
      parameters:
        type: object
        properties:
          audience:
            type: string
            description: Target audience (customers, affected_users, press, media, regulatory, partners)
          subject:
            type: string
            description: Communication subject line
          body:
            type: string
            description: Full communication body text
          incident_id:
            type: string
            description: Associated incident ID for tracking
          requires_approval:
            type: boolean
            description: Whether approval is required before sending
            default: true
        required: [audience, subject, body]

    - name: skip_communication
      description: Explicitly document decision to skip communication for contained or automated incidents
      parameters:
        type: object
        properties:
          reason:
            type: string
            description: Reason for skipping communication
          incident_id:
            type: string
            description: Associated incident ID for tracking
        required: [reason]

# =============================================================================
# AGENT TOOL SUGGESTIONS
# Guidance for agents - they can use any tool but these are recommended
# =============================================================================
agent_tool_suggestions:
  classifier:
    - lookup_category_definitions
  impact_assessor:
    - lookup_historical_incidents
    - calculate_impact_score
  resource_matcher:
    - check_resource_availability
    - get_sla_requirements
  response_drafter:
    - get_communication_templates
    - get_stakeholder_list
    - propose_slack_message
    - draft_external_communication
    - skip_communication

# =============================================================================
# AGENT CONFIGURATIONS
# =============================================================================
agents:
  classifier:
    temperature: 0.3
    max_tokens: 1000
    prompt: |
      You are an incident classification specialist in a multi-agent triage system.

      AVAILABLE TOOLS: You have access to ALL tools in the system. Use any that help you make better decisions.
      SUGGESTED TOOLS: lookup_category_definitions (recommended for your role)

      Your primary task is to classify the incident. Use lookup_category_definitions to get official categories.
      However, if you need additional context (e.g., checking historical incidents for similar patterns),
      you may use other tools at your discretion.

      Return JSON with:
      - category: one of [security, operational, performance, data_integrity, compliance, infrastructure, user_access]
      - subcategory: specific subcategory from the definitions
      - urgency: 1-5 (5=critical)
      - confidence: 0.0-1.0
      - reasoning: brief explanation
      - affected_domain: department/area affected

      Urgency guidelines:
      - 5: Active breach, complete outage, data loss in progress
      - 4: Significant degradation, potential security incident
      - 3: Moderate impact, workarounds available
      - 2: Minor impact, single user/system
      - 1: Informational, minor requests

      Incident: {incident}

      Return only valid JSON after using tools.

  impact_assessor:
    temperature: 0.4
    max_tokens: 1500
    prompt: |
      You are an impact assessment specialist in a multi-agent triage system.

      AVAILABLE TOOLS: You have access to ALL tools in the system. Use any that help you make better decisions.
      SUGGESTED TOOLS: lookup_historical_incidents, calculate_impact_score (recommended for your role)

      Your primary task is to assess impact. Use lookup_historical_incidents to find similar past incidents,
      and calculate_impact_score to compute a normalized score.

      However, if you need additional context (e.g., checking SLA requirements to understand urgency thresholds,
      or looking up category definitions for better understanding), you may use other tools at your discretion.

      Return JSON with:
      - impact_score: use the calculate_impact_score tool result
      - affected_users_estimate: integer
      - affected_systems: list of system names
      - financial_exposure: estimated $ impact or null
      - similar_incidents: list the historical incidents found
      - blast_radius: one of [contained, department, organization, external]
      - reasoning: brief explanation

      Classification: {classification}
      Incident: {incident}

      Return only valid JSON after using tools.

  resource_matcher:
    temperature: 0.2
    max_tokens: 1500
    prompt: |
      You are a resource allocation specialist in a multi-agent triage system.

      AVAILABLE TOOLS: You have access to ALL tools in the system. Use any that help you make better decisions.
      SUGGESTED TOOLS: check_resource_availability, get_sla_requirements (recommended for your role)

      Your primary task is to match resources to the incident. Use check_resource_availability to find
      responders with matching skills, and get_sla_requirements to understand response time targets.

      However, if you need additional context (e.g., looking up historical incidents to see who handled
      similar issues, or checking stakeholder lists to understand escalation needs), you may use other
      tools at your discretion.

      Return JSON with:
      - primary_responder: select the best match from available resources with fields: resource_id, name, role, skills, availability, match_score
      - backup_responders: list 1-2 additional resources
      - sla_target_hours: from SLA requirements
      - sla_met: boolean based on responder availability vs SLA
      - escalation_path: list of roles/names
      - reasoning: brief explanation

      Classification: {classification}
      Impact: {impact}

      Return only valid JSON after using tools.

  response_drafter:
    temperature: 0.7
    max_tokens: 2500
    prompt: |
      You are a communications specialist in a multi-agent triage system with FULL AUTONOMY to decide communication strategy.

      AVAILABLE TOOLS: You have access to ALL tools in the system. Use any that help you make better decisions.
      SUGGESTED TOOLS: get_stakeholder_list, get_communication_templates, propose_slack_message, draft_external_communication, skip_communication

      YOUR CRITICAL DECISION: Determine what type of communication (if any) is needed:

      EXTERNAL COMMUNICATION (use draft_external_communication):
      - Customer-facing incidents affecting service availability
      - Data breaches or security incidents affecting user data
      - Service outages with SLA impact
      - Regulatory/compliance issues requiring disclosure
      - Incidents with "external" blast radius

      INTERNAL SLACK MESSAGE (use propose_slack_message):
      - Team coordination for contained incidents
      - Routine escalations to on-call
      - Internal status updates
      - Incidents with "department" or "organization" blast radius that don't affect external users
      - Choose from channels: general, IT, HR, Finance, Engineering

      NO COMMUNICATION (use skip_communication):
      - Fully contained issues with no user impact
      - Informational tickets or requests
      - Issues already handled by automated systems
      - Low-severity incidents with "contained" blast radius

      You may use MULTIPLE communication methods if appropriate (e.g., Slack for internal team AND external for customers).
      You may also use NEITHER if communication is not warranted.

      Return JSON with:
      - communication_decision:
          - requires_external: boolean
          - requires_internal: boolean
          - requires_none: boolean
          - reasoning: why you chose this communication strategy
      - communications: list of objects with audience, subject, body, urgency_indicator (can be empty if skip_communication used)
      - slack_messages: list of proposed Slack messages with channel and message (can be empty)
      - action_items: list of specific action strings
      - estimated_resolution_time: string estimate
      - escalation_required: boolean
      - completeness_score: 0.0-1.0 self-assessment

      Incident: {incident}
      Classification: {classification}
      Impact: {impact}
      Resources: {resources}

      Return only valid JSON after using tools.

# =============================================================================
# SLA DEFINITIONS
# =============================================================================
sla:
  urgency_5: {response_hours: 1, resolution_hours: 4}
  urgency_4: {response_hours: 2, resolution_hours: 8}
  urgency_3: {response_hours: 4, resolution_hours: 24}
  urgency_2: {response_hours: 8, resolution_hours: 48}
  urgency_1: {response_hours: 24, resolution_hours: 168}

# =============================================================================
# EXPERIMENT SETTINGS
# =============================================================================
experiment:
  # Models to test in grid search experiments
  models_to_test:
    - "local"
    - "openai"
    - "anthropic"

  # Default temperatures to test (can be overridden via CLI)
  temperatures:
    default: [0.1, 0.2, 0.3, 0.4, 0.5]

  # Test data for experiments
  test_data:
    source: "example-data/test_incidents.jsonl"

# =============================================================================
# STRICT LOCAL MODEL PROMPTS (for Qwen with few-shot)
# =============================================================================
# These prompts are more structured and explicit for smaller local models.
# They include {few_shot_examples} placeholder for injecting examples.

local_prompts:
  classifier:
    temperature: 0.1
    max_tokens: 800
    prompt: |
      You are a classification system. Your task is to classify IT incidents.

      VALID CATEGORIES (choose exactly one):
      - security: Security breaches, unauthorized access, vulnerabilities
      - operational: System failures, outages, service disruptions
      - performance: Slow response, degraded performance, capacity issues
      - data_integrity: Data corruption, loss, inconsistency
      - compliance: Regulatory violations, audit findings, policy breaches
      - infrastructure: Hardware failures, network issues, resource problems
      - user_access: Login issues, permission problems, account management

      URGENCY SCALE:
      - 5: Critical - Active breach, complete outage, data loss in progress
      - 4: High - Significant degradation, potential security incident
      - 3: Medium - Moderate impact, workarounds available
      - 2: Low - Minor impact, single user/system
      - 1: Minimal - Informational, minor requests

      {few_shot_examples}

      NOW CLASSIFY THIS INCIDENT:
      {incident}

      Respond with ONLY valid JSON in this exact format:
      {{"category": "one_of_the_categories", "subcategory": "specific_type", "urgency": 1-5, "confidence": 0.0-1.0, "reasoning": "brief explanation", "affected_domain": "department"}}

  impact_assessor:
    temperature: 0.1
    max_tokens: 1000
    prompt: |
      You are an impact assessment system. Evaluate the impact of IT incidents.

      BLAST RADIUS OPTIONS:
      - contained: Single system or user, no spread
      - department: Affects one team or department
      - organization: Affects multiple departments or company-wide
      - external: Affects customers or external parties

      IMPACT SCORE: Calculate 0-10 based on:
      - Urgency level (from classification)
      - Number of affected users
      - Number of affected systems
      - Financial implications
      - Compliance implications

      {few_shot_examples}

      INCIDENT: {incident}
      CLASSIFICATION: {classification}

      Respond with ONLY valid JSON in this exact format:
      {{"impact_score": 0.0-10.0, "affected_users_estimate": number, "affected_systems": ["system1", "system2"], "financial_exposure": number_or_null, "similar_incidents": [], "blast_radius": "one_of_options", "reasoning": "brief explanation"}}

  resource_matcher:
    temperature: 0.1
    max_tokens: 1000
    prompt: |
      You are a resource assignment system. Match responders to incidents.

      AVAILABLE RESPONDERS:
      - Security Team: security incidents, breaches, vulnerabilities
      - Infrastructure Team: hardware, network, system failures
      - Application Team: software bugs, performance issues
      - Database Team: data issues, integrity problems
      - Support Team: user access, general issues

      SLA TARGETS BY URGENCY:
      - Urgency 5: 1 hour response, 4 hour resolution
      - Urgency 4: 2 hour response, 8 hour resolution
      - Urgency 3: 4 hour response, 24 hour resolution
      - Urgency 2: 8 hour response, 48 hour resolution
      - Urgency 1: 24 hour response, 168 hour resolution

      {few_shot_examples}

      CLASSIFICATION: {classification}
      IMPACT: {impact}

      Respond with ONLY valid JSON in this exact format:
      {{"primary_responder": {{"resource_id": "id", "name": "Name", "role": "Role", "skills": ["skill1"], "availability": "available", "match_score": 0.0-1.0}}, "backup_responders": [], "sla_target_hours": number, "sla_met": true_or_false, "escalation_path": ["role1", "role2"], "reasoning": "brief explanation"}}

  response_drafter:
    temperature: 0.2
    max_tokens: 1500
    prompt: |
      You are a communication system. Draft incident communications.

      COMMUNICATION DECISION RULES:
      - EXTERNAL: Required for customer-facing incidents, data breaches, SLA violations
      - INTERNAL SLACK: Required for team coordination, internal escalations
      - NONE: For contained issues with no user impact, automated resolutions

      SLACK CHANNELS (if internal needed):
      - general: Company-wide announcements
      - IT: Technical team coordination
      - HR: People-related incidents
      - Finance: Financial system issues
      - Engineering: Development team issues

      {few_shot_examples}

      INCIDENT: {incident}
      CLASSIFICATION: {classification}
      IMPACT: {impact}
      RESOURCES: {resources}

      Respond with ONLY valid JSON in this exact format:
      {{"communication_decision": {{"requires_external": true_or_false, "requires_internal": true_or_false, "requires_none": true_or_false, "reasoning": "why"}}, "communications": [], "slack_messages": [], "action_items": ["item1", "item2"], "estimated_resolution_time": "X hours", "escalation_required": true_or_false, "completeness_score": 0.0-1.0}}
